(defn sop-rows [rows average-positions]
  (as-> rows _
        (filter sop? _)
        (op/pivot-by-type-for-offer _ (map :event common/funnel))
        (add-web-canada-id-and-property offer-data _)
        (remove-unwanted-property-ids property-ids _)
        (op/add-rates _ common/rate-specs)
        (op/add-money-per-shows _)
        (op/add-money-per-conversions _)
        (add-average-positions average-positions start-date end-date _)
        (op/sort-by-columns [:property_id :show-converted-rate] _)))
