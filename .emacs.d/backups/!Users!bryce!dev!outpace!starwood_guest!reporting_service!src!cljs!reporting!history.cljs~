(ns reporting.history
  (:require
   [bd-tool.data :as data]
   [bd-tool.location :as loc]
   [bd-tool.util :as util]
   [cljs-http.client :as http]
   [goog.events :as events]
   [secretary.core :as secretary])
  (:import goog.History
           goog.history.EventType))

(def history nil)


(defn history-listener [e]
  (let [token (.-token e)
        next-route (secretary/dispatch! token)]
    (log-navigate token)
    ))

(defn start! []
  (let [h (History.)]
    (events/listen h EventType.NAVIGATE history-listener)

    (def history (doto h (.setEnabled true)))
    (when (empty? (loc/get-hash))
      (loc/set-hash! "#/"))))

(defn stop! []
  (events/unlisten history EventType.NAVIGATE history-listener)
    (def history nil))
